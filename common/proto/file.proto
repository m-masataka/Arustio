syntax = "proto3";

package arustio.file;
import "meta.proto";

// File service for filesystem operations
service FileService {
  // List files and directories in a path
  rpc ListFiles(ListFilesRequest) returns (ListFilesResponse);

  // Get file status (metadata)
  rpc Stat(StatRequest) returns (StatResponse);

  // Create a directory
  rpc Mkdir(MkdirRequest) returns (MkdirResponse);

  // Copy file from local to Arustio
  rpc CopyFromLocal(stream CopyFromLocalRequest) returns (CopyFromLocalResponse);

  // Read file content
  rpc Read(ReadRequest) returns (stream ReadResponse);

  // Read blocks of a file
  rpc ReadBlock(ReadBlockRequest) returns (stream ReadBlockResponse);

  // Write file content
  rpc WriteFile(stream WriteFileRequest) returns (WriteFileResponse);

  // Write Block of a file
  rpc WriteBlock(stream WriteBlockRequest) returns (WriteBlockResponse);

  // Remove file
  rpc RemoveFile(RemoveFileRequest) returns (RemoveFileResponse);

  // Remove directory
  rpc RemoveDir(RemoveDirRequest) returns (RemoveDirResponse);

}

// List files request
message ListFilesRequest {
  string path = 1;
}

// List files response
message ListFilesResponse {
  repeated arustio.meta.FileMetadata entries = 1;
}

// Stat request
message StatRequest {
  string path = 1;
}

// Stat response
message StatResponse {
  arustio.meta.FileMetadata entry = 1;
}

// Mkdir request
message MkdirRequest {
  string path = 1;
}

// Mkdir response
message MkdirResponse {
  bool success = 1;
  string message = 2;
}

// CopyFromLocal request (streaming)
message CopyFromLocalRequest {
  oneof data {
    CopyFromLocalMetadata metadata = 1;
    bytes chunk = 2;
  }
}

// CopyFromLocal metadata
message CopyFromLocalMetadata {
  string destination_path = 1;
  uint64 file_size = 2;
}

// CopyFromLocal response
message CopyFromLocalResponse {
  bool success = 1;
  string message = 2;
  uint64 bytes_written = 3;
}

// CopyToLocal request
message CopyToLocalRequest {
  string source_path = 1;
}

// CopyToLocal response (streaming)
message CopyToLocalResponse {
  oneof data {
    CopyToLocalMetadata metadata = 1;
    bytes chunk = 2;
  }
}

// CopyToLocal metadata
message CopyToLocalMetadata {
  uint64 file_size = 1;
}

// Read request
message ReadRequest {
  string path = 1;
}

// Read response (streaming)
message ReadResponse {
  oneof data {
    arustio.meta.FileMetadata metadata = 1;
    bytes chunk = 2;
  }
}

// ReadBlock request
message ReadBlockRequest {
  string path = 1;
  string file_id = 2;
  arustio.meta.BlockDesc block_desc = 3;
}

// WriteBlock request (streaming)
message WriteBlockRequest {
  oneof data {
    WriteBlockMetadata metadata = 1;
    bytes chunk = 2;
  }
}

message WriteBlockMetadata {
  string path = 1;
  string file_id = 2;
  arustio.meta.BlockDesc block_desc = 3;
}

// WriteBlock response
message WriteBlockResponse {
  bool success = 1;
  string message = 2;
  uint64 bytes_written = 3;
}

// ReadBlock response (streaming)
message ReadBlockResponse {
  bytes chunk = 1;
}


// WriteFile request (streaming)
message WriteFileRequest {
  oneof data {
    WriteFileMetadata metadata = 1;
    bytes chunk = 2;
  }
}

// WriteFile metadata
message WriteFileMetadata {
  string path = 1;
}

// WriteFile response
message WriteFileResponse {
  bool success = 1;
  string message = 2;
  uint64 bytes_written = 3;
}

// RemoveFile request
message RemoveFileRequest {
  string path = 1;
}

// RemoveFile response
message RemoveFileResponse {
  bool success = 1;
  string message = 2;
}

// RemoveDir request
message RemoveDirRequest {
  string path = 1;
}

// RemoveDir response
message RemoveDirResponse {
  bool success = 1;
  string message = 2;
}
